
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
    <link href="~/Content/css/bootstrap.css" rel="stylesheet"/>
    <link href="~/Content/fonts/font-awesome/css/fontawesome-all.min.css"  rel="stylesheet"/>
    <link href="~/Content/fonts/font-awesome/css/fa-brands.min.css"  rel="stylesheet"/>
    <link href="~/Content/fonts/font-awesome/css/fa-regular.min.css"  rel="stylesheet"/>
    <link href="~/Content/fonts/font-awesome/css/fa-solid.min.css" rel="stylesheet" />
    <link href="~/Content/fonts/font-awesome/css/fontawesome.min.css" rel="stylesheet" />
    <link href="~/Content/css/jquery.dataTables.min.css" rel="stylesheet" />
    <style>
        .borderGreen {
            border-left:2px solid green;
        }
        .error {
            color: red;
        }
        .letrareceta {
            font-family: 'Indie Flower', cursive;
        }
        .transparencia {
        color:rgba(255, 125, 0, 0.5);
        }
        .letrareceta2 {
        font-family: 'Quicksand', sans-serif;
        color:black;
        font-style:italic
        }

        .column {
            float: left;
            padding: 10px;
        }

        .left, .right {
            width: 15%;
            height: 100vh;
            background: url("../../ImagesUsuarios/fondo4.jpg")
        }

        .middle {
            width: 70%;
        }

        
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
        html, body {
            height: 100%;
        }
    </style>
    <script type="text/javascript">
        var idRecetaDetalle = null;
        var usuarioactual = null
        var entroUsuarios = false;
        var entroRecetas = false;
        var entroUsuariosRecetas = false;
    </script>
</head>
<body @*class="container"*@ >

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container" style="max-width: 4000px;height: 50px !important;">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a target="_blank" href="#" class="navbar-brand">
                <img src="~/ImagesUsuarios/recetas.png" width="50" height="50"/>
                    Recetas mágicas</a>
            </div>
            <div class="collapse navbar-collapse">
                @if (Session["ID_Usuario"] != null)
                {
                    <strong id="idusuariosirve" hidden>@Session["ID_Usuario"].ToString()</strong>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span class="fa fa-user"></span>
                            <strong>@Session["Nombre"].ToString()</strong>
                            <span class="fa fa-caret-down"></span>
                        </a>
                        <ul class="dropdown-menu" style="width: 290px;height: 160px;">
                            <li>
                                <div class="navbar-login">
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <p class="text-center">
                                                <span class="fa fa-user fa-6x" style="margin-left: 10px;"></span>
                                            </p>
                                        </div>
                                        <div class="col-lg-8">
                                            <p class="text-left"><strong>@Session["Nombre"].ToString()</strong></p>
                                            <p class="text-left small">@Session["Correo"].ToString()</p>
                                            <p class="text-left">
                                                <a onclick="usuarios.actualizar()" class="btn btn-primary btn-block btn-sm">Actualizar Datos</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="navbar-login navbar-login-session">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <p>
                                                <a href="#" class="btn btn-danger btn-block" onclick="usuarios.logout()">Cerrar Sesion</a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
                }
                else
                {
                    <ul class="nav navbar-nav navbar-right">
                        <li><a onclick="usuarios.new()"><i class="fa fa-user-plus">Registrarme</i></a></li>
                        <li><a onclick="usuarios.sesion()"><i class="fa fa-sign-in-alt">Iniciar sesión</i></a></li>
                    </ul>
                }
            </div>
        </div>
    </div>

    <div class="block-flat">
        <div class="header col-md-12 row" style="margin-right: 0px;">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <h3>Recetas</h3>
            </div>
        </div>
        <div class="row">
            <div class="column left"></div>
            <div class="column middle">

                @if (Session["ID_Usuario"] != null)
                {
                    <button class="btn btn-primary" type="button" onclick="recetas.new()"><i class="fa fa-plus"></i> Agregar receta</button>
                }
                <div style="margin-top: 30px;">
                    <div class="form-group text-right">
                        <label>Ver solo:</label>
                        <select class="form-control" name="ver" size="1" onchange="infoTabla(this)">
                            <option value="recetas">Recetas</option>
                            <option value="usuarios">Usuarios</option>
                        </select>
                    </div>
                    <table class="table table-striped letrareceta2" style="display:none;" id="tbl_Recetas">
                        <thead>
                            <tr id="tablaColumnas"></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <table class="table table-striped letrareceta2" style="display:none;" id="tbl_usuarios">
                        <thead>
                            <tr id="tablaColumna_usuarios"></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="column right"></div>
        </div>
    </div>

    <div aria-hidden="true" aria-labelledby="mod_receta_detalle" class="modal fade mod_receta_detalle" id="mod_receta_detalle" role="dialog" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-hidden="true" class="close" data-dismiss="modal" type="button" tabindex="-1">×</button>
                        <h4 class="modal-title" id="mod_receta_title"></h4> 
                    </div>
                    <div class="modal-body" id="contenidomodreceta">
                        <div class="row borderGreen">
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                                <label>Categoría:</label>                            
                            </div>
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_categoria"></strong>
                            </div>
                        </div>
                        <div class="row borderGreen">
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                                <label>Usuario:</label>
                            </div>
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_Usuario"></strong>
                            </div>
                        </div>
                        <div class="row borderGreen">
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                                <label>Likes:</label>
                            </div>
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_likes"></strong>
                                 @if (Session["ID_Usuario"] != null) {
                                <a id="manoarriba" onclick="recetas.sumar()"><i class="far fa-thumbs-up"></i></a>
                                 }
                            </div>
                        </div>
                        <div class="row borderGreen">
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                                <label>Dislikes:</label>
                            </div>
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_dislikes"></strong>
                                @if (Session["ID_Usuario"] != null) {
                                <a id="manoabajo" onclick="recetas.restar()"><i class="far fa-thumbs-down"></i></a>
                                }
                            </div>                    
                        </div>
                        <div class="row borderGreen">
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                                <label>Ingredientes:</label>
                            </div>
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_ingredientes"></strong>
                            </div>
                        </div>
                        <div class="row borderGreen">
                            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6">
                                <label>Descripcion:</label>
                            </div>
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_descripcion"></strong>
                            </div>
                        </div>
                        
                        <div class="row borderGreen" id="todasLasImagenes">
                            <img id="imagen_receta1" name="imagen_receta1"/>
                            <img id="imagen_receta2" name="imagen_receta2"/>
                            <img id="imagen_receta3" name="imagen_receta3"/>
                            <img id="imagen_receta4" name="imagen_receta4"/>
                        </div>

                        <div class="row borderGreen" id="videoReceta">
                        </div>

                        <br />
                        <div class="row borderGreen">
                            <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6">
                                <strong id="mod_receta_comentarios"></strong>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        @if (Session["ID_Usuario"] != null)
                        {
                            <div class="row borderGreen">
                                <div class="input-group">
                                    <span class="input-group-addon" id="sizing-addon2">Agrega un comentario</span>
                                    <input type="text" id="txtcomentario" class="form-control" onkeyup="btnEnviarComentario.removeAttribute('disabled'), ActivarbtnComentario ()" placeholder="Comentario" aria-describedby="sizing-addon2">
                                </div>
                            </div>
                            <button disabled class="btn btn-default" id="btnEnviarComentario" onclick="enviarComentario()" data-dismiss="modal" type="button" tabindex="-1">Guardar</button>
                        }
                         
                        <button class="btn btn-default" data-dismiss="modal" type="button" tabindex="-1">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>


    <div aria-hidden="true" aria-labelledby="mod_receta" class="modal fade mod_receta" id="mod_receta" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button" tabindex="-1">×</button>
                    <h4 class="modal-title" id="mod_receta">Nueva receta</h4>
                </div>
                <form action="#" id="form_receta">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="txt_receta_nombre">Nombre</label>
                            <input class="form-control input-md" type="text" maxlength="50" placeholder="Nombre de la receta" id="txt_receta_nombre" name="txt_receta_nombre"/>
                        </div>
                        <div class="form-group">
                            <label for="txt_receta_categoria">Categoría</label>
                            <select id="txt_receta_categoria" name="txt_receta_categoria" class="form-control"></select>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-success" onclick="ingredientes.new()" type="button" style="border-radius: 50%;"><i class="fa fa-plus"></i></button>
                            <label for="tbl_ingredientes">Ingredientes</label>
                            <table class="table table-responsive" id="tbl_ingredientes">
                                <thead>
                                    <tr>
                                        <th class="col-lg-1 col-md-2 col-sm-3 col-xs-3">Cantidad</th>
                                        <th class="col-lg-4 col-md-5 col-sm-3 col-xs-3">Unidad</th>
                                        <th class="col-lg-7 col-md-5 col-sm-6 col-xs-6">Ingrediente</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <div class="form-group">
                            <label for="txt_receta_instrucciones">Instrucciones</label>
                            <textarea id="txt_receta_instrucciones" name="txt_receta_instrucciones" class="form-control"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="txt_receta_instrucciones">Imagen</label>
                            <input type="file" id="imagenreceta1" name="imagenreceta1" onchange="nombre(this.value)" accept="image/png, .jpeg, .jpg, image/gif">
                            <input type="file" id="imagenreceta2" name="imagenreceta2" onchange="nombre(this.value)" accept="image/png, .jpeg, .jpg, image/gif">
                            <input type="file" id="imagenreceta3" name="imagenreceta3" onchange="nombre(this.value)" accept="image/png, .jpeg, .jpg, image/gif">
                            <input type="file" id="imagenreceta4" name="imagenreceta4" onchange="nombre(this.value)" accept="image/png, .jpeg, .jpg, image/gif">
                        </div>
                        <div class="form-group">
                            <label for="txt_receta_instrucciones">Liga video</label>
                            <input class="form-control input-md" type="text" placeholder="Poner link del video, solo YouTube y un solo link" id="txt_receta_video" name="txt_receta_video" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-default" data-dismiss="modal" type="button">Cancelar</button>
                        <button class="btn btn-primary" type="submit" onclick="recetas.validate()"><i class="fa fa-save"></i> Guardar</button>
                    </div>
                </form>                
            </div>
        </div>
    </div>

    @* MODAL USUARIO *@

    <div aria-hidden="true" aria-labelledby="mod_usuario" class="modal fade mod_usuario" id="mod_usuario" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button" tabindex="-1">×</button>
                    <h3 class="modal-title" id="mod_usuario">Registro</h3>
                </div>
                <form action="#" id="form_usuario">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="txt_Usuario_nombre">Nombre</label>
                            <input class="form-control input-md" type="text" maxlength="50" placeholder="Nombre" id="txt_usuario_nombre" name="txt_usuario_nombre" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_imagen">Imagen</label>
                            @*<button class="btn btn-md form-control btn-primary" onclick="$('#imagenusuario').click()">Click aquí para elegir imagen</button>*@
                           <input type="file" class="btn btn-md form-control btn-primary" id="imagenusuario" name="imagenusuario" onchange="nombre(this.value)" accept="image/png, .jpeg, .jpg, image/gif">
                           @*<input type="text" id="exp-img-btn"height="5" width="5" name="exp-img-btn" />*@
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_corre">Correo</label>
                            <input type="text" id="txt_usuario_correo" maxlength="50" placeholder="Correo Electronico" name="txt_usuario_correo" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_password">Password</label>
                            <input type="password" id="txt_usuario_password" maxlength="50" placeholder="Password" name="txt_usuario_password" class="form-control" />
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Cancelar</button>
                            <button class="btn btn-primary" type="submit" onclick="usuarios.validateUsuario()"><i class="fa fa-save"></i> Guardar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    @*PERFIL USUARIO*@
    <div aria-hidden="true" aria-labelledby="mod_usuario_perfil" class="modal fade mod_usuario_perfil" id="mod_usuario_perfil" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button" tabindex="-1">×</button>
                    <h4 class="modal-title" id="mod_usuario_perfil"></h4>
                </div>
                <form action="#" id="form_usuario_perfil">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="txt_usuario_nombre_perfil">Nombre</label>
                            <label class="form-control input-md" type="text" maxlength="50" id="txt_usuario_nombre_perfil" name="txt_usuario_nombre_perfil" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_imagen_perfil">Imagen</label>
                            <img id="imagen_usuario_perfil" name="imagen_usuario_perfil" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_correo_perfil">Correo</label>
                            <label type="text" id="txt_usuario_correo_perfil" maxlength="50"  name="txt_usuario_correo_perfil" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_nivel_perfil">Nivel</label>
                            <label id="txt_usuario_nivel_perfil" maxlength="50" name="txt_usuario_nivel_perfil" class="form-control" />
                        </div>
                        <table class="table table-striped letrareceta2 " style="display:none;" id="tbl_Recetas_usuario">
                            <thead>
                                <tr id="tablaColumnas_usuario"></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Cancelar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    @*INICIAR SESION*@
    <div aria-hidden="true" aria-labelledby="mod_usuariosesion" class="modal fade mod_usuariosesion" id="mod_usuariosesion" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button" tabindex="-1">×</button>
                    <h3 class="modal-title" id="mod_usuariosesion">¡Bienvenido de nuevo!</h3>
                </div>
                <form action="#" id="form_usuariosesion">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="txt_usuario_corre">Correo</label>
                            <input type="text" id="txt_usuario_correosesion" maxlength="50" placeholder="Correo Electronico" name="txt_usuario_correosesion" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_password">Password</label>
                            <input type="password" id="txt_usuario_passwordsesion" maxlength="50" placeholder="Password" name="txt_usuario_passwordsesion" class="form-control" />
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Cancelar</button>
                            <button class="btn btn-primary" type="submit" onclick="usuarios.login()"><i class="fa fa-sign-in-alt"></i> Entrar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div> 
    </div>
    @*ACTUALIZAR USUARIO*@
    <div aria-hidden="true" aria-labelledby="mod_usuario_actualizar" class="modal fade mod_usuario_actualizar" id="mod_usuario_actualizar" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button" tabindex="-1">×</button>
                    <h4 class="modal-title" id="mod_usuario_actualizar"></h4>
                </div>
                <form action="#" id="form_usuario_ac">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="txt_Usuario_nombre_ac">Nombre</label>
                            <input class="form-control input-md" type="text" maxlength="50" placeholder="Nombre" id="txt_usuario_nombre_ac" name="txt_usuario_nombre_ac" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_imagen_ac">Imagen</label>
                            <img id="imagenusuario_ac" name="imagenusuario_ac">
                            <br />
                            <input type="file" id="imagenusuario_ac" name="imagenusuario_ac" onchange="nombre(this.value)" accept="image/png, .jpeg, .jpg, image/gif">
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_corre_ac">Correo</label>
                            <input type="text" id="txt_usuario_correo_ac" maxlength="50" placeholder="Correo Electronico" name="txt_usuario_correo_ac" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="txt_usuario_password_ac">Password</label>
                            <input type="password" id="txt_usuario_password_ac" maxlength="50" placeholder="Password" name="txt_usuario_password_ac" class="form-control" />
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal" type="button">Cancelar</button>
                            <button class="btn btn-primary" type="submit" onclick="usuarios.actualizarbtn()"><i class="fa fa-save"></i> Guardar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="~/Content/js/jquery.min.js"  type="text/javascript"></script>
    <script src="~/Content/js/bootstrap.min.js"  type="text/javascript"></script>
    <script src="~/Content/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="~/Content/js/moment.js" type="text/javascript"></script>
    <script src="~/Content/js/jquery-validation-1.14.0/dist/jquery.validate.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        var contadorIngredientes = 0;
        var recetanueva = false;
        var formUsuario;

        function  ActivarbtnComentario () {
            if ($("#txtcomentario").val() == null || $("#txtcomentario").val() == "") {
                document.getElementById("btnEnviarComentario").disabled = true;
            }
         }

        var usuarios = (function () {
            return {
                get: function () {
                    ajax.get('/Usuario/GetAll', function (data) {
                        if (!entroUsuarios) {
                            $("#tablaColumna_usuarios").append("<th>Nombre</th><th>Correo</th><th>Nivel</th><th>Ver</th>")
                            entroUsuarios = true;
                        }
                        var date = new Date();
                        $("#tbl_usuarios").DataTable({
                            destroy: true,
                            info: false,
                            searching: true,
                            "bAutoWidth": false,
                            "bProcessing": false,
                            //"bLengthChange": false,
                            "aaData": data,
                            "aoColumns": [
                                { "mData": "Nombre" },
                                { "mData": "Correo" },
                                { "mData": "Nivel" },
                                {
                                    "mRender": function (data, type, full) {
                                        return '<button type="button" class="btn btn-success" onclick="usuarios.getbyId(' + full.ID_Usuario + ')"><i class="fa fa-list"></i></button>';
                                    }
                                }
                            ],
                            "language": {
                                "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
                            }
                        });
                        if (data.length > 0)
                        {
                            $("#tbl_usuarios").show();
                            $("#tbl_Recetas_wrapper").hide()
                            $("#tbl_Recetas").hide()
                        } else
                            $("#tbl_usuarios").hide();
                    });
                },
                new: function () {
                    $("#mod_usuario").modal('show');
                },
                getbyId: function (id) {
                    ajax.get('/Usuario/GeyIdUsuario', { idusuario: id }, function (usuario) {
                        var idbienusuario = id;
                        var nombre = usuario.Nombre;
                        $("#txt_usuario_nombre_perfil").text(nombre)
                        $("#txt_usuario_correo_perfil").text(usuario.Correo)
                        $("#imagen_usuario_perfil").attr('src', 'data:image/jpg;base64,' + usuario.imagen)
                        $("#imagen_usuario_perfil").attr('height', "300")
                        $("#imagen_usuario_perfil").attr('width', "300")
                        $("#txt_usuario_nivel_perfil").text(usuario.Nivel)
                        if (!entroUsuariosRecetas) {
                            $("#tablaColumnas_usuario").append("<th>Nombre</th><th>Fecha</th><th>Likes</th><th>Dislikes</th><th>Ver</th>")
                            entroUsuariosRecetas = true;
                        }
                        ajax.get('/Recetas/GetByIdUsuario', { idusuario: idbienusuario }, function (chilo) {
                            $("#tbl_Recetas_usuario").DataTable({
                                destroy: true,
                                info: false,
                                searching: true,
                                "bAutoWidth": false,
                                "bProcessing": false,
                                //"bLengthChange": false,
                                "aaData": chilo,
                                "aoColumns": [
                                    { "mData": "Nombre" },
                                    { "mData": "Fecha_Alta" },
                                    { "mData": "Likes" },
                                    { "mData": "Dislikes" },
                                    {
                                        "mRender": function (data, type, full) {
                                            return '<button type="button" class="btn btn-success" onclick="recetas.getbyId(' + full.ID_Receta + ')"><i class="fa fa-list"></i></button>';
                                        }
                                    }
                                ],
                                "language": {
                                    "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
                                }
                            });
                            if (chilo.length > 0) {
                                $("#mod_usuario_perfil").modal('show');
                                $("#mod_usuario_perfil").on("hidden.bs.modal", function () {
                                    $("#tbl_Recetas_usuario").modal('hide');
                                })
                                $("#tbl_Recetas_usuario").modal('show');

                            } else $("#tbl_Recetas_usuario").hide();

                        })
                    });
                },
                sesion: function(){
                    $("#mod_usuariosesion").modal('show');
                },
                actualizar: function () {
                    $("#mod_usuario_actualizar").modal('show');
                    ajax.post('/Usuario/Get', function (usuario) {
                        $("#txt_usuario_nombre_ac").val(usuario.Nombre)
                        $("#txt_usuario_correo_ac").val(usuario.Correo)
                        $("#txt_usuario_password_ac").val(usuario.Contrasenia)
                        $("#imagenusuario_ac").attr('src', 'data:image/jpg;base64,' + usuario.imagen)
                        $("#imagenusuario_ac").attr('height', "300")
                        $("#imagenusuario_ac").attr('width', "300")
                    })
                },
                actualizarbtn: function() {
                    ajax.get('/Usuario/ActualizarUsuario',{nombre:$("#txt_usuario_nombre_ac").val(),correo:$("#txt_usuario_correo_ac").val(),contrasenia:$("#txt_usuario_password_ac").val()}, function (data){
                        if (data == 'true') {
                            alert('Información actualizada correctamente');
                        }
                    })
                },
                logout: function(){
                    ajax.get('/Usuario/Logout', function (data) {
                        if (data == "True")
                            location.reload(true);
                    })
                },
                add: function (elNuevoUsuario) {
                    ajax.post('/Usuario/Add', { nombre: elNuevoUsuario.nombre, correo: elNuevoUsuario.correo, contrasenia: elNuevoUsuario.contrasenia, imagen: elNuevoUsuario.imagen}, function (data) {
                        if (data == "True") {
                            alert('Agregado con éxito');
                            $("#mod_usuario").modal('hide');
                            recetas.get();
                        }
                    });
                },
                validateUsuario: function () {
                    formUsuario = $("#form_usuario").validate({
                        rules:
                        {
                            txt_usuario_nombre: { required: true },
                            txt_usuario_correo: { required: true },
                            txt_usuario_password: { required: true }
                        },
                        messages:
                        {
                            txt_usuario_nombre: { required: 'Campo requerido' },
                            txt_usuario_correo: { required: 'Campo requerido' },
                            txt_usuario_password: { required: 'Campo requerido' }
                        },
                        submitHandler: function (formUsuario) {
                            var obj = {
                                nombre: $("#txt_usuario_nombre").val(),
                                correo: $("#txt_usuario_correo").val(),
                                contrasenia: $("#txt_usuario_password").val(),
                                imagen: ayuda //$("#imagenusuario").val()
                            }
                            usuarios.add(obj);
                            return false;
                        }
                    });
                },
                login: function () {
                    $.post("/Usuario/Login", { correo: $("#txt_usuario_correosesion").val(), contrasenia: $("#txt_usuario_passwordsesion").val() })
                        .done(function (data) {
                        if (data == "True") {
                            $("#mod_usuariosesion").modal('hide');
                            location.reload(true);
                        }
                        else {
                            alert("Datos Erroneos");
                        }
                    })

                }
            }
        })();
        var recetas = (function () {
            var formReceta;
            return {
                get: function () {
                    ajax.get("/Recetas/Get", null,
                        //Al responder
                        function (data) {
                            if (!entroRecetas) {
                                $("#tablaColumnas").append("<th>Nombre</th><th>Fecha</th><th>Likes</th><th>Dislikes</th><th>Ver</th>")
                                entroRecetas = true;
                            }
                            $("#tbl_Recetas").DataTable({
                                destroy: true,
                                info: false,
                                searching: true,
                                "bAutoWidth": false,
                                "bProcessing": false,
                                //"bLengthChange": false,
                                "aaData": data,
                                "aoColumns": [
                                    { "mData": "Nombre" },
                                    { "mData": "Fecha_Alta"},
                                    { "mData": "Likes" },
                                    { "mData": "Dislikes" },
                                    //{
                                    //    "mRender": function (data, type, full) {
                                    //        var fecha = moment(full.Fecha).toDate();
                                    //        return moment(fecha).format('DD/MMM/YYYY ');
                                    //    }
                                    //},
                                    {
                                        "mRender": function (data, type, full) {

                                           
                                            return '<button type="button" class="btn btn-success" onclick="recetas.getbyId(' + full.ID_Receta + ')"><i class="fa fa-list"></i></button>';

                                        }
                                    }
                                ],
                                "language": {
                                    "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Spanish.json"
                                }
                            });
                            if (data.length > 0)
                            {
                                $("#tbl_usuarios").hide();
                                $("#tbl_usuarios_wrapper").hide()
                                $("#tbl_Recetas").show();
                            }
                            else $("#tbl_Recetas").hide();
                        });
                },
                getbyId: function (id) {
                    ajax.get('/Recetas/GetbyId', { id: id },
                        // AQUI MODIFIQUE: ESTABA Data y yo puse receta en function
                       function (receta) {
                           $("#mod_receta_title").text(receta.Nombre);

                           //var estrellas = '';
                           //switch (receta.Puntuacion) {
                           //    case 0: estrellas = '<i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>';
                           //        break;
                           //    case 1: estrellas = '<i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>';
                           //        break;
                           //    case 2: estrellas = '<i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>';
                           //        break;
                           //    case 3: estrellas = '<i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>';
                           //        break;
                           //    case 4: estrellas = '<i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star"></i>';
                           //        break;
                           //    case 5: estrellas = '<i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i><i class="fa fa-star" style="color:yellow;"></i>';
                           //        break;
                           //}

                           idRecetaDetalle = receta.ID_Receta;
                           $("#mod_receta_likes").text(receta.Likes);
                           $("#mod_receta_dislikes").text(receta.Dislikes);
                           var fecha = moment(receta.Fecha_Alta).toDate();
                           $("#mod_receta_fecha").text(moment(fecha).format('DD/MM/YYYY'));
                           $("#mod_receta_descripcion").text(receta.Descripcion);

                           $("#mod_receta_detalle").modal('show');
                           $("#mod_receta_detalle").on("hidden.bs.modal", function () {
                               //$("#mod_receta_detalle").modal('show');
                           })
                           ajax.get('/Recetas/traerImagenes', { idreceta: idRecetaDetalle }, function (imagenes) {
                               var jsonImagen = imagenes

                               $("#imagen_receta1").removeAttr("src");
                               $("#imagen_receta2").removeAttr("src");
                               $("#imagen_receta3").removeAttr("src");
                               $("#imagen_receta4").removeAttr("src");

                               if (jsonImagen.length > 0) {

                                   for (var i = 0; i < jsonImagen.length; i++) {
                                       $('#imagen_receta' + [i + 1]).attr('src', "..\\ImagesUsuarios\\" + jsonImagen[i])
                                       $('#imagen_receta' + [i + 1]).attr('width', "300")
                                       $('#imagen_receta' + [i + 1]).attr('height', "300")
                               }
                               }
                           })
                           ajax.get('/Recetas/traerVideo',{idreceta: idRecetaDetalle}, function(video){
                               if (video != "") {
                                   $("#videoReceta").text("");
                                   $("#videoReceta").val("");
                                   $("#videoReceta").append('<a href=' + video +' '+'target="_blank">Video de la receta</a>')
                               }
                           })
                           ajax.get('/Recetas/CategoriasbyID', { idcategoria: receta.ID_Categoria },
                               function (categoria) {
                                   $("#mod_receta_categoria").text(categoria);
                               })
                           ajax.get('/Recetas/IngredientesGetbyIDReceta', { idreceta: receta.ID_Receta },
                               function (ingrediente) {
                                   var ingredientes = ""
                                   $("#mod_receta_ingredientes").text("")
                                   for (var x = ingrediente.length - 1; x >= 0; x--) {
                                       ingredientes = ingredientes + ingrediente[x] + "<br>";
                                   }
                                   $("#mod_receta_ingredientes").append(ingredientes)
                               })
                           ajax.get('/Recetas/GetUsuariobyID', {idusuario: receta.ID_Usuario},
                               function (usuarioencontrado) {
                                   $("#mod_receta_Usuario").text(usuarioencontrado.Nombre)

                               })
                           ajax.post('/Recetas/GetComentariosByIdReceta', {idreceta: id},
                               function (comentarios) {
                                   $("#mod_receta_comentarios").text("");
                                   for (var i = 0; i < comentarios.length; i++) {
                                        buscardueniocomentario(comentarios[i].ID_Usuario);
                                       $("#mod_receta_comentarios").append('<div class="row borderGreen"> <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6"> <label>' + usuarioactual + ':</label></div>  <div class="col-lg-9 col-md-9 col-sm-6 col-xs-6"> <strong id="mod_receta_comentarios">' + comentarios[i].Comentario + '</strong><div>' + comentarios[i].Fecha + '<div> </div></div>')
                                   }
                               })
                       })
                },
                new: function () {
                    categorias.get(function (data) {

                        $("#txt_receta_categoria option").remove();
                        var html = '<option value="null" selected disabled>Seleccione una categoría</option>';
                        for (var i = data.length - 1; i >= 0; i--) {
                            html += '<option value="' + data[i].ID_Categoria + '">' + data[i].Nombre + '</option>';
                        }

                        $("#txt_receta_categoria").append(html);
                    });
                    $("#mod_receta").modal('show');
                },

                add: function (receta) {
                    //data: '{"Nombre:"' + $("#txt_receta_nombre").val() + '", "Descripcion":"' + $("#txt_receta_instrucciones").val() + '", "Fecha":"' + fecha + '", "Puntuacion":"' + 0 + '", "ID_Categoria":"' + ok + '","ID_Usuario": "1"  }'
                    idReceta: ajax.post('/Recetas/Add', receta, function (idreceta) {
                        if (idreceta != 0) {
                            alert('Agregado con éxito');
                            $("#mod_receta").modal('hide');
                            recetas.get();
                        }
                    });
                },
                sumar: function () {
                        ajax.post('/Recetas/SumarORestar', {operacion: 'Sumar', idreceta: idRecetaDetalle}, function (receta) {
                            $("#mod_receta_likes").text(receta.Likes)
                            $("#mod_receta_dislikes").text(receta.Dislikes)
                        })              
                },
                restar: function () {
                    ajax.post('/Recetas/SumarORestar', { operacion: 'Restar', idreceta: idRecetaDetalle }, function (receta) {
                        $("#mod_receta_likes").text(receta.Likes)
                        $("#mod_receta_dislikes").text(receta.Dislikes)
                    })
                },
                update: function (receta) {

                },
                delete: function (receta) {

                },
                validate: function () {
                            //window.navigator = '/Recetas/Index';
                            formReceta = $("#form_receta").validate({
                            rules:
                                {
                                txt_receta_nombre: { required: true },
                            txt_receta_instrucciones: { required: true },
                            txt_receta_categoria: { required: true }
                                },
                        messages:
                                {
                                txt_receta_nombre: { required: 'Campo requerido' },
                                txt_receta_instrucciones: { required: 'Campo requerido' },
                                txt_receta_categoria: { required: 'Campo requerido' }
                                },
                        submitHandler: function (formReceta) {
                                    var lista = new Array();
                                    for (var i = 1; i <= contadorIngredientes; i++) {
                                        var objeto = {
                                    ingrediente: $("#txt_ingredientecantidad" + i).val() + " " + $("#txt_ingredienteunidad" + i).val() + " " + $("#txt_ingrediente" + i).val()
                                        };
                                    lista.push(objeto);
                                }
                                    var obj = {
                                nombre: $("#txt_receta_nombre").val(),
                                descripcion: $("#txt_receta_instrucciones").val(),
                                id_categoria: $("#txt_receta_categoria").val(),
                                ingredientes: JSON.stringify(lista),
                                imagen: ayuda,
                                video:$("#txt_receta_video").val()
                                    }
                            recetas.add(obj);
                            return false;
                        }
                    });
                },

            }
        })();
        var ingredientes = (function () {
            var htmlunidades = '';
            return {
                new: function () {
                    if ($("#txt_ingredientecantidad" + contadorIngredientes).text() != "" && $("#txt_ingredienteunidad" + contadorIngredientes).text() != "") {
                        contadorIngredientes++
                        var renglon = '<tr><td><input type="number" id="txt_ingredientecantidad' + contadorIngredientes + '" class="input-md form-control" min="0.01" step="1" max="1000"/></td><td><input type="text" id="txt_ingredienteunidad' + contadorIngredientes + '"  class="input-md form-control"/></td> <td><input type="text" id="txt_ingrediente' + contadorIngredientes + '"  class="input-md form-control"/></td></tr>'
                        $("#tbl_ingredientes tbody").append(renglon);
                    }
                    
                }
            }
        })();

            var categorias = (function () {
                return {
                    get: function (callback) {
                        ajax.get('/Recetas/Categorias', null, callback);
                    }
                }
            })();
            //$(document).ready(function() {

            //    // Escuchamos el evento 'change' del input donde cargamos el archivo
            //    $(document).on('change', 'input[type=file]', function(e) {
            //        // Obtenemos la ruta temporal mediante el evento
            //        var TmpPath = URL.createObjectURL(e.target.files[0]);
            //        // Mostramos la ruta temporal
            //        $('span').html(TmpPath);
            //        $('img').attr('src', TmpPath);
            //    });

            //});

            var ajax = (function () {
                return {
                    get: function (url, params, done) {
                        $.get(url, params).done(done).fail(ajax.fail);
                    },
                    post: function (url, params,done) {
                        $.post(url, params).done(done).fail(ajax.fail);
                    },
                    put: function (url, params, done) {
                        $.put(url, params).done(done).fail(ajax.fail);
                    },
                    delete: function (url, params, done) {
                        $.delete(url, params).done(done).fail(ajax.fail);
                    },
                    fail: function (err) {
                        alert("Ocurrió un error al consultar el servidor");
                        console.error(err);
                    }
                }
            })();

            var ayuda = null;

            function nombre(fic) {
                fic = fic.split('\\');
                ayuda = fic[fic.length - 1];
            }


            $(function () {
                recetas.get();
            });
            var usuario = null;
            function buscardueniocomentario(idUsuarioABuscar) {
                ajax.post('/Usuario/GeyIdUsuario', { idusuario: idUsuarioABuscar },
                   function (usuario)
                   {
                       usuarioactual = usuario;
                   }
                )}

            function enviarComentario() {
               resultado: ajax.get('/Recetas/GuardarComentario', { idreceta: idRecetaDetalle, idusuario: $("#idusuariosirve").text(), comentario: $("#txtcomentario").val() }, function () {
                   if (resultado)
                   {
                       alert('Comentario enviado exitosamente');
                   }
                   else
                   {
                       ajax.fail();
                   }
               })
            }
    //     function readFile(input) {
    //    if (input.files && input.files[0]) {
    //        var reader = new FileReader();
 
    //        reader.onload = function (e) {
    //            var filePreview = document.createElement('img');
    //            filePreview.id = 'file-preview';
    //            //e.target.result contents the base64 data from the image uploaded
    //            filePreview.src = e.target.result;
    //            console.log(e.target.result);
 
    //            var previewZone = document.getElementById('file-preview-zone');
    //            previewZone.appendChild(filePreview);
    //        }
 
    //        reader.readAsDataURL(input.files[0]);
    //    }
    //}
 
    //var fileUpload = document.getElementById('file-upload');
    //fileUpload.onchange = function (e) {
    //    readFile(e.srcElement);
    //}
            function infoTabla(resultado)
            {
                if (resultado.value == 'recetas')
                {

                    recetas.get();
                    
                }
                else
                {
                    usuarios.get();
                }
            }

 </script>
</body>
</html>